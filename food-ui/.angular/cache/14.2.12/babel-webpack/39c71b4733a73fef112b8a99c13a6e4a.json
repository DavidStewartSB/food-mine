{"ast":null,"code":"import _asyncToGenerator from \"E:/Projetos/angular/food-project/food-ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Order } from 'src/app/shared/models';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/order.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"src/app/services/cart.service\";\nimport * as i4 from \"ngx-toastr\";\nimport * as i5 from \"../../partials/title/title.component\";\nimport * as i6 from \"../../partials/order-items-list/order-items-list.component\";\nimport * as i7 from \"../../partials/map/map.component\";\nexport class PaymentPageComponent {\n  constructor(orderService, router, cartService, toastr) {\n    this.orderService = orderService;\n    this.router = router;\n    this.cartService = cartService;\n    this.toastr = toastr;\n    this.order = new Order();\n    this.orderService.getNewOrderForCurrentUser().subscribe({\n      next: order => {\n        this.order = order;\n      },\n      error: err => {\n        this.router.navigateByUrl('/checkout');\n      }\n    });\n  }\n\n  ngOnInit() {\n    this.paypalHook();\n  }\n\n  paypalHook() {\n    var _this = this;\n\n    const self = this;\n    paypal.Buttons({\n      createOrder: (data, actions) => {\n        return actions.order.create({\n          purchase_units: [{\n            amount: {\n              currency_code: 'BRL',\n              value: self.order.totalPrice\n            }\n          }]\n        });\n      },\n      onApprove: function () {\n        var _ref = _asyncToGenerator(function* (data, actions) {\n          const payment = yield actions.order.capture();\n          _this.order.paymentId = payment.id;\n          self.orderService.pay(_this.order).subscribe({\n            next: orderId => {\n              _this.cartService.clearCart();\n\n              _this.router.navigateByUrl('/track/' + orderId);\n\n              _this.toastr.success('Pagemento feito com sucesso!', 'Concluído');\n            },\n            error: error => {\n              _this.toastr.error('Falha ao efetuar o pagamento', 'Error');\n            }\n          });\n        });\n\n        return function onApprove(_x, _x2) {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      onError: err => {\n        this.toastr.error('Falha ao processar pagamento', 'Error');\n        console.log(err);\n      }\n    }).render(this.paypalElement.nativeElement);\n  }\n\n}\n\nPaymentPageComponent.ɵfac = function PaymentPageComponent_Factory(t) {\n  return new (t || PaymentPageComponent)(i0.ɵɵdirectiveInject(i1.OrderService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.CartService), i0.ɵɵdirectiveInject(i4.ToastrService));\n};\n\nPaymentPageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: PaymentPageComponent,\n  selectors: [[\"app-payment-page\"]],\n  decls: 22,\n  vars: 5,\n  consts: [[1, \"container\", \"mx-auto\", \"mt-5\"], [1, \"grid\", \"grid-cols-12\", \"gap-6\"], [1, \"content\", \"col-span-12\", \"md:col-span-6\"], [\"title\", \"Resumo do pedido\", \"fontSize\", \"1.6rem\", 1, \"font-bold\"], [1, \"summary\", \"flex\", \"mt-3\"], [1, \"\"], [3, \"order\"], [1, \"map\", \"col-span-12\", \"md:col-span-6\"], [\"title\", \"Endere\\u00E7o para envio\", \"fontSize\", \"1.6rem\", 1, \"font-bold\"], [3, \"readonly\", \"order\"], [1, \"btn-container\", \"w-full\", \"flex\", \"justify-center\", \"mt-10\"], [\"paypal\", \"\"]],\n  template: function PaymentPageComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"section\", 0)(1, \"div\", 1)(2, \"div\", 2);\n      i0.ɵɵelement(3, \"app-title\", 3);\n      i0.ɵɵelementStart(4, \"div\", 4)(5, \"div\")(6, \"h3\");\n      i0.ɵɵtext(7, \"Nome:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(8, \"span\", 5);\n      i0.ɵɵtext(9);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(10, \"div\")(11, \"h3\");\n      i0.ɵɵtext(12, \"Endere\\u00E7o:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(13, \"span\", 5);\n      i0.ɵɵtext(14);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelement(15, \"order-items-list\", 6);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(16, \"div\", 7);\n      i0.ɵɵelement(17, \"app-title\", 8)(18, \"map\", 9);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(19, \"div\", 10);\n      i0.ɵɵelement(20, \"div\", null, 11);\n      i0.ɵɵelementEnd()();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(9);\n      i0.ɵɵtextInterpolate(ctx.order.name);\n      i0.ɵɵadvance(5);\n      i0.ɵɵtextInterpolate(ctx.order.address);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"order\", ctx.order);\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"readonly\", true)(\"order\", ctx.order);\n    }\n  },\n  dependencies: [i5.TitleComponent, i6.OrderItemsListComponent, i7.MapComponent],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJwYXltZW50LXBhZ2UuY29tcG9uZW50LnNjc3MifQ== */\"]\n});","map":{"version":3,"mappings":";AAKA,SAASA,KAAT,QAAsB,uBAAtB;;;;;;;;;AAQA,OAAM,MAAOC,oBAAP,CAA2B;EAG/BC,YACUC,YADV,EAC8CC,MAD9C,EAEUC,WAFV,EAGUC,MAHV,EAG+B;IAFrB;IAAoC;IACpC;IACA;IALV,aAAe,IAAIN,KAAJ,EAAf;IAME,KAAKG,YAAL,CAAkBI,yBAAlB,GAA8CC,SAA9C,CAAwD;MACtDC,IAAI,EAAGC,KAAD,IAAU;QACd,KAAKA,KAAL,GAAaA,KAAb;MAED,CAJqD;MAKtDC,KAAK,EAAGC,GAAD,IAAQ;QACb,KAAKR,MAAL,CAAYS,aAAZ,CAA0B,WAA1B;MACD;IAPqD,CAAxD;EAUD;;EAEDC,QAAQ;IACN,KAAKC,UAAL;EACD;;EAECA,UAAU;IAAA;;IACV,MAAMC,IAAI,GAAG,IAAb;IACAC,MAAM,CACLC,OADD,CACS;MACPC,WAAW,EAAE,CAACC,IAAD,EAAYC,OAAZ,KAA4B;QACvC,OAAOA,OAAO,CAACX,KAAR,CAAcY,MAAd,CAAqB;UAC1BC,cAAc,EAAE,CACd;YACEC,MAAM,EAAE;cACNC,aAAa,EAAE,KADT;cAENC,KAAK,EAAEV,IAAI,CAACN,KAAL,CAAWiB;YAFZ;UADV,CADc;QADU,CAArB,CAAP;MAUD,CAZM;MAcPC,SAAS;QAAA,6BAAE,WAAOR,IAAP,EAAkBC,OAAlB,EAAkC;UAC3C,MAAMQ,OAAO,SAASR,OAAO,CAACX,KAAR,CAAcoB,OAAd,EAAtB;UACA,KAAI,CAACpB,KAAL,CAAWqB,SAAX,GAAuBF,OAAO,CAACG,EAA/B;UACAhB,IAAI,CAACb,YAAL,CAAkB8B,GAAlB,CAAsB,KAAI,CAACvB,KAA3B,EAAkCF,SAAlC,CACE;YACEC,IAAI,EAAGyB,OAAD,IAAY;cAChB,KAAI,CAAC7B,WAAL,CAAiB8B,SAAjB;;cACA,KAAI,CAAC/B,MAAL,CAAYS,aAAZ,CAA0B,YAAYqB,OAAtC;;cACA,KAAI,CAAC5B,MAAL,CAAY8B,OAAZ,CACE,8BADF,EAEE,WAFF;YAID,CARH;YASEzB,KAAK,EAAGA,KAAD,IAAU;cACf,KAAI,CAACL,MAAL,CAAYK,KAAZ,CAAkB,8BAAlB,EAAkD,OAAlD;YACD;UAXH,CADF;QAeD,CAlBQ;;QAAA;UAAA;QAAA;MAAA,GAdF;MAkCP0B,OAAO,EAAGzB,GAAD,IAAa;QACpB,KAAKN,MAAL,CAAYK,KAAZ,CAAkB,8BAAlB,EAAkD,OAAlD;QACA2B,OAAO,CAACC,GAAR,CAAY3B,GAAZ;MACD;IArCM,CADT,EAwCC4B,MAxCD,CAwCQ,KAAKC,aAAL,CAAmBC,aAxC3B;EAyCD;;AAlE8B;;;mBAApBzC,sBAAoB0C;AAAA;;;QAApB1C;EAAoB2C;EAAAC;EAAAC;EAAAC;EAAAC;IAAA;MCbjCL,mCAAwC,CAAxC,EAAwC,KAAxC,EAAwC,CAAxC,EAAwC,CAAxC,EAAwC,KAAxC,EAAwC,CAAxC;MAGYA;MACIA,+BAA+B,CAA/B,EAA+B,KAA/B,EAA+B,CAA/B,EAA+B,IAA/B;MAEYA;MAAKA;MACTA;MAAeA;MAAcA;MAGjCA,6BAAK,EAAL,EAAK,IAAL;MACQA;MAASA;MACbA;MAAeA;MAAiBA;MAG5CA;MACJA;MAEAA;MACIA,iCAAuF,EAAvF,EAAuF,KAAvF,EAAuF,CAAvF;MAGJA;MAGJA;MACIA;MACJA;;;;MApBmCA;MAAAA;MAKAA;MAAAA;MAGTA;MAAAA;MAMbA;MAAAA,gCAAiB,OAAjB,EAAiBM,SAAjB","names":["Order","PaymentPageComponent","constructor","orderService","router","cartService","toastr","getNewOrderForCurrentUser","subscribe","next","order","error","err","navigateByUrl","ngOnInit","paypalHook","self","paypal","Buttons","createOrder","data","actions","create","purchase_units","amount","currency_code","value","totalPrice","onApprove","payment","capture","paymentId","id","pay","orderId","clearCart","success","onError","console","log","render","paypalElement","nativeElement","i0","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["E:\\Projetos\\angular\\food-project\\food-ui\\src\\app\\components\\pages\\payment-page\\payment-page.component.ts","E:\\Projetos\\angular\\food-project\\food-ui\\src\\app\\components\\pages\\payment-page\\payment-page.component.html"],"sourcesContent":["import { Component, OnInit, Output } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { ToastrService } from 'ngx-toastr';\nimport { CartService } from 'src/app/services/cart.service';\nimport { OrderService } from 'src/app/services/order.service';\nimport { Order } from 'src/app/shared/models';\n\ndeclare var paypal: any;\n@Component({\n  selector: 'app-payment-page',\n  templateUrl: './payment-page.component.html',\n  styleUrls: ['./payment-page.component.scss']\n})\nexport class PaymentPageComponent implements OnInit {\n  order: Order = new Order();\n\n  constructor(\n    private orderService: OrderService, private router: Router,\n    private cartService: CartService,\n    private toastr: ToastrService,) { \n    this.orderService.getNewOrderForCurrentUser().subscribe({\n      next: (order) => {\n        this.order = order\n        \n      },\n      error: (err) => {\n        this.router.navigateByUrl('/checkout')\n      },\n    })\n\n  }\n\n  ngOnInit(): void {\n    this.paypalHook()\n  }\n\n    paypalHook():void {\n    const self = this;\n    paypal\n    .Buttons({\n      createOrder: (data: any, actions: any) => {\n        return actions.order.create({\n          purchase_units: [\n            {\n              amount: {\n                currency_code: 'BRL',\n                value: self.order.totalPrice,\n              },\n            },\n          ],\n        });\n      },\n\n      onApprove: async (data: any, actions: any) => {\n        const payment = await actions.order.capture();\n        this.order.paymentId = payment.id;\n        self.orderService.pay(this.order).subscribe(\n          {\n            next: (orderId) => {\n              this.cartService.clearCart();\n              this.router.navigateByUrl('/track/' + orderId);\n              this.toastr.success(\n                'Pagemento feito com sucesso!',\n                'Concluído'\n              );\n            },\n            error: (error) => {\n              this.toastr.error('Falha ao efetuar o pagamento', 'Error');\n            }\n          }\n        );\n      },\n\n      onError: (err: any) => {\n        this.toastr.error('Falha ao processar pagamento', 'Error');\n        console.log(err);\n      },\n    })\n    .render(this.paypalElement.nativeElement);\n  }\n\n\n}\n","<section class=\"container mx-auto mt-5\">\n    <div class=\"grid grid-cols-12 gap-6\">\n        <div class=\"content col-span-12 md:col-span-6\">\n            <app-title title=\"Resumo do pedido\" fontSize=\"1.6rem\" class=\"font-bold\"></app-title>\n                <div class=\"summary flex mt-3\">\n                    <div>\n                        <h3>Nome:</h3>\n                        <span class=\"\">{{order.name}}</span>\n                    </div>\n\n                    <div>\n                        <h3>Endereço:</h3>\n                        <span class=\"\">{{order.address}}</span>\n                    </div>\n                </div>\n            <order-items-list [order]=\"order\"></order-items-list>\n        </div>\n\n        <div class=\"map col-span-12 md:col-span-6\" >\n            <app-title title=\"Endereço para envio\" fontSize=\"1.6rem\" class=\"font-bold\"></app-title>\n\n            <map [readonly]=\"true\" [order]=\"order\"></map>\n        </div>\n    </div>\n\n    <div class=\"btn-container w-full flex justify-center mt-10\">\n        <div #paypal></div>\n    </div>\n</section>"]},"metadata":{},"sourceType":"module"}